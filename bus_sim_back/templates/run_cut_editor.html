<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EV Bus Sim - Run/Charge Schedule Editor</title>
    <!-- Links to both general and editor-specific stylesheets -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/editor_style.css') }}">
</head>
<body>
    <div class="container"> <!-- Wrapped content in a container for consistency -->
        <h1>Run/Charge Schedule Editor</h1>
        
        <!-- NEW: Modern Navigation Bar -->
        <nav>
            <ul class="main-nav">
                <li><a href="{{ url_for('index') }}" class="nav-link">Configuration</a></li>
                <li><a href="{{ url_for('editor') }}" class="nav-link">Schedule Editor</a></li>
                <li><a href="{{ url_for('analytics') }}" class="nav-link">Fleet Analytics</a></li>
            </ul>
        </nav>
        
        <div class="editor-controls">
            <label for="run-cut-name">Schedule Name:</label>
            <input type="text" id="run-cut-name" placeholder="e.g., Weekday Peak Schedule">
            <button id="save-run-cut-btn">üíæ Save Schedule</button>
            <button id="load-run-cut-btn">üìÇ Load Schedule</button>
            <button id="clear-run-cut-btn">üóëÔ∏è Clear Schedule</button>
            <button id="add-bus-btn">‚ûï Add Bus</button>
            <span id="run-cut-status" class="status-message"></span>
            <button id="run-simulation-btn" style="background-color: #007bff; color: white;">‚ñ∂Ô∏è Run Simulation</button>
        </div>

        <div class="schedule-grid-container">
            <table id="schedule-grid">
                <thead>
                    <!-- Header row will be generated by JS -->
                </thead>
                <tbody id="schedule-grid-body">
                    <!-- Bus rows will be generated by JS -->
                </tbody>
            </table>
        </div>

        <div id="simulation-results-container" style="margin-top: 20px; border: 1px solid #ccc; padding: 15px; display: none;">
            <h2>Simulation Results</h2>
            <button id="close-results-btn" style="float: right;">Close Results</button>
            <div id="simulation-output">
                <p>Simulation not yet run.</p>
            </div>
        </div>

        <div id="activity-popover" class="popover" style="display: none; position: absolute; border: 1px solid black; background-color: white; padding: 15px; box-shadow: 3px 3px 5px rgba(0,0,0,0.3);">
            <h4>Assign Activity</h4>
            <p><strong id="popover-cell-info">Bus: ?, Time: ?</strong></p>
            <button class="activity-btn" data-activity="RUN">üü¶ RUN</button>
            <button class="activity-btn" data-activity="BREAK">üü® BREAK</button>
            <button class="activity-btn" data-activity="CHARGE">üü© CHARGE</button>
            <button class="activity-btn" data-activity="DEADHEAD" style="background-color: #cccccc;">‚ö´ DEADHEAD</button>

            <div id="charge-options" style="display: none; margin-top: 10px;">
                <label for="charger-select">Select Charger:</label>
                <select id="charger-select">
                    <option value="">--Select Charger--</option>
                </select>
            </div>
            <hr>
            <button id="popover-cancel">Cancel</button>
        </div>

        <div id="load-modal" class="modal-overlay" style="display: none;">
            <div class="modal-content">
                <button id="modal-close-btn" class="modal-close-btn" title="Close">√ó</button>
                <h2>Load Saved Schedule</h2>
                <div id="modal-run-cut-list">
                    <p>Loading...</p>
                </div>
            </div>
        </div>
    </div> <!-- Closing container div -->

    <!-- JavaScript Links -->
    <script src="{{ url_for('static', filename='js/run_cut_editor.js') }}"></script>
    <script src="{{ url_for('static', filename='js/simulation.js') }}"></script>
    <!-- ADDED: Link to main script for navigation handler -->
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>

</body>
</html>